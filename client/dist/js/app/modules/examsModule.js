define("text!templates/exams/examsTpl.hbs",[],function(){return'<div id="{{id}}" class="enw__widget">\n	<h3 class="enw__title"></h3>\n	<div>\n		<div class="enw__menu enw__menu--primary"></div>\n		<div class="enw__menu enw__menu--secondary"></div>\n	</div>\n    <div class="enw__msgbox"></div>\n	<div class="enw__content">\n		<div class="enw__chart avgChart"></div>\n		<div class="enw__chart subjectChart"></div>\n		<div class="enw__chart subjectYearChart"></div>\n		<div class="enw__table avgYearTable"></div>\n	</div>\n</div>'}),define("models/examsModel",["models/defaultModel"],function(e){return e.extend({path:"api/exams/ege"})}),define("views/exams/examsAvgChartView",["views/chartView","underscore","utils"],function(e,t){return e.extend({examType:"ege",type:"spline",options:{yAxis:{title:{text:"score".toLocaleString()+", %"}},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+this.x+": "+this.y.toPrecision(3)}},plotOptions:{series:{point:{events:{click:function(){return this.series.chart.options.getWidget().switchMode({year:this.category}),this.category}}}}},series:[{name:"weightedAvg".toLocaleString()},{name:"weightedAvgMathRus".toLocaleString()}]},dataproc:{respDivider:function(e,a,i,n){n=n||0;var r;return t.map(i,function(t){return r=e[t-n],"number"!=typeof r||isNaN(r)?null:r/(a[t-n]||1)})}},update:function(e){if(this.chart&&e&&!t.isEqual(this.data,e)){this.data=e;var a,i,n=1/0,r=-1/0,s={},o={},l=this.chart.series,d={},c={};return t.each(e,function(e){i=e.year||new Date(e.date).getFullYear(),e.year=i,i>r&&(r=i),n>i&&(n=i)}),t.each(e,function(e){i=e.year-n,s[i]=100*e.average/e.limit*e.total+(s[i]||0),o[i]=e.total+(o[i]||0),("math"===e.name||"russian"===e.name)&&(c[i]=100*e.average/e.limit*e.total+(c[i]||0),d[i]=e.total+(d[i]||0))}),a=t.range(n,r+1),l[0].update({data:this.dataproc.respDivider(s,o,a,n)},!1),l[1].update({data:this.dataproc.respDivider(c,d,a,n)},!1),this.chart.xAxis[0].setCategories(a,!1),this.redraw(),l}}})}),define("views/exams/examsSubjectChartView",["views/chartView","underscore","utils"],function(e,t,a){var i="#777",n="#EEE";return e.extend({type:"spline",options:{yAxis:[{title:{text:"score".toLocaleString()+", %",style:{color:i,fontWeight:"normal"}},gridLineColor:n},{title:{text:"choice".toLocaleString()+", %",style:{color:i,fontWeight:"normal"}},gridLineColor:n,opposite:!0}],plotOptions:{series:{point:{events:{click:function(){return this.series.chart.options.getWidget().switchMode({year:this.category}),this.category}}}}},series:[{name:"school".toLocaleString()},{name:"district".toLocaleString()},{name:"region".toLocaleString()},{name:"country".toLocaleString()},{name:"whoChose".toLocaleString(),dashStyle:"shortdot",yAxis:1}]},update:function(e){if(this.chart&&e){var i,n,r=1/0,s=-1/0,o={school:[],city:[],region:[],country:[],choice:[]};return t.each(e,function(e){var t=new Date(e.date).getFullYear();t>s&&(s=t),r>t&&(r=t),e.y=t}),t.each(e,function(e){n=e.y-r,o.school[n]=e.average,o.city[n]=e.averageCity,o.region[n]=e.averageRegion,o.country[n]=e.averageCountry,o.choice[n]=100*e.total/(e.gtotal||e.total||1)}),i=t.range(r,s+1),t.each(o,function(e){e=a.replace(void 0,null)}),this.updateSpline(o.school,o.city,o.region,o.country,o.choice),this.chart.xAxis[0].setCategories(i,!1),this.redraw(),o}return void 0}})}),define("views/exams/examsSubjectYearChartView",["views/chartView","underscore","utils"],function(e){return e.extend({type:"pie",options:{series:[{size:"60%",dataLabels:{formatter:function(){return this.y>5?this.point.name:null},color:"white",distance:-30}},{size:"80%",innerSize:"60%",dataLabels:{formatter:function(){return this.y>0?"<b>"+this.point.name+"</b><br/>"+this.y.toPrecision(3)+"%":null}}}]},update:function(e){if(this.chart&&e){e.total=e.total/100;var t,a,i,n=e.belowThreshold/e.total,r=100-n,s=(e.excellent-e.bullseye)/e.total,o=e.bullseye/e.total,l=r-o-s,d=Highcharts.getOptions().colors,c=["passed".toLocaleString(),"failed".toLocaleString()],h=[],u=[];for(e=[{y:r,color:d[0],drilldown:{name:"failed".toLocaleString(),categories:[e.threshold+" ... "+e.excellentThreshold,"excellent".toLocaleString()+" (>"+e.excellentThreshold+")","maximum".toLocaleString()+" ("+e.limit+")"],data:[l,s,o],color:d[0]}},{y:n,color:d[1],drilldown:{name:"passed".toLocaleString(),categories:["0 ... "+e.threshold],data:[n],color:d[1]}}],t=0;t<e.length;t+=1)for(h.push({name:c[t],y:e[t].y,color:e[t].color}),a=0;a<e[t].drilldown.data.length;a+=1)i=.2-a/e[t].drilldown.data.length/5,u.push({name:e[t].drilldown.categories[a],y:e[t].drilldown.data[a],color:Highcharts.Color(e[t].color).brighten(i).get()});return this.updatePie(h,u),this.redraw(),this.chart.series}}})}),define("text!templates/exams/examsTableTpl.hbs",[],function(){return'<div class="enw--halfwidth">\n    <div class="enw__summary examAvg"></div>\n    <div class="enw__summary-comment enw--halfwidth">{{l10n "weightedAvgFull"}}</div>\n</div>\n\n<div class="enw--halfwidth">\n    <div class="enw__summary examAvgMathRus"></div>\n    <div class="enw__summary-comment enw--halfwidth">{{l10n "weightedAvgMathRusFull"}}</div>\n</div>\n\n<table class="enw__table"  data-sortable>\n    <thead class="enw__table__header enw__table__header--alignleft">\n        <tr>\n            <th>{{l10n "subject"}}</th>\n            <th>{{l10n "choice"}},%</th>\n            <th>{{l10n "threshold"}}</th>\n            <th>{{l10n "min"}}</th>\n            <th>{{l10n "max"}}</th>\n            <th>{{l10n "limit"}}</th>\n\n            <th>{{l10n "failMark"}},%</th>\n            <th>{{l10n "exMark"}},%</th>\n\n            <th>{{l10n "avgSchool"}}</th>\n            <th>{{l10n "district"}}</th>\n            <th>{{l10n "region"}}</th>\n            <th>{{l10n "RF"}}</th>\n        </tr>\n    </thead>\n    <tbody class="enw__table__tbody">\n    </tbody>\n</table>'}),define("text!templates/exams/examsRowTpl.hbs",[],function(){return'<tr>\n    <td><a class="enw__link" data-subject="{{name}}" data-year="{{year}}">{{fullName}}</a></td>\n    <td>{{part}}</td>\n    <td>{{threshold}}</td>\n    <td>{{minimum}}</td>\n    <td>{{maximum}}</td>\n    <td>{{limit}}</td>\n    <td>{{belowThreshold}}</td>\n    <td>{{excellent}}</td>\n    <td>{{average}}</td>\n    <td>{{averageCity}}</td>\n    <td>{{averageRegion}}</td>\n    <td>{{averageCountry}}</td>\n</tr>'}),define("views/exams/examsAvgYearView",["views/tableView","underscore","text!templates/exams/examsTableTpl.hbs","text!templates/exams/examsRowTpl.hbs"],function(e,t,a,i){return e.extend({template:a,rowTemplate:i,renderRow:function(e,t){return this.rowTemplate({type:e.type,name:e.name,fullName:String(e.name).toLocaleString(),year:t,part:e.gtotal?(100*e.total/e.gtotal).toPrecision(3):"",threshold:e.threshold,minimum:e.minimum,maximum:e.maximum,limit:e.limit,belowThreshold:e.belowThreshold?(100*e.belowThreshold/e.total).toPrecision(3):"—",excellent:(100*e.excellent/e.total).toPrecision(3),average:e.average,averageCity:e.averageCity,averageRegion:e.averageRegion,averageCountry:e.averageCountry})},afterRender:function(){var e=".enw__link";this.$el.on("click",e,$.proxy(this.onSubjectLinkClick,this)),this.initSortable()},onSubjectLinkClick:function(e){var t,a,i;return e&&2===this.widget.status&&this.widget.switchMode&&(t=$(e.target),a=t.data("subject"),i=t.data("year"),this.widget.switchMode(a,i)),a},update:function(e,a){if(e&&a){var i="",n=0,r=0,s=0,o=0,l=this,d=".enw__table__tbody",c=".examAvg",h=".examAvgMathRus";t.each(t.sortBy(e,function(e){return String(e.name).toLocaleString()}),function(e){n+=e.total*e.average,s+=e.total,("math"===e.name||"russian"===e.name)&&(r+=e.total*e.average,o+=e.total),i+=l.renderRow(e,a)}),this.$el.find(d).html(i),this.$el.find(c).html(n?(n/s).toPrecision(3):"—"),this.$el.find(h).html(r?(r/o).toPrecision(3):"—")}return e}})}),define("views/exams/examsView",["framework","views/defaultView","text!templates/exams/examsTpl.hbs","models/examsModel","underscore","utils","views/exams/examsAvgChartView","views/exams/examsSubjectChartView","views/exams/examsSubjectYearChartView","views/exams/examsAvgYearView"],function(e,t,a,i,n,r,s,o,l,d){var c=".enw__menu--primary",h=".enw__menu--secondary";return t.extend({template:a,name:"examsTpl",title:"egeTitle",ModelConstructor:i,mode:{subject:"avg",year:"yearSlice"},renderData:function(){var e=this.model.get("collection"),t=this.getRelatedView();return this.renderMenu&&(this.renderMenu(["avg"].concat(n.uniq(n.pluck(e,"name"))),c),this.renderMenu(["yearSlice"].concat(n.uniq(n.map(e,function(e){return new Date(e.date).getFullYear().toString()}))),h),this.renderMenu=void 0),this.showMsg(),t&&(t.render(e||this.model.attributes,this.model.get("subtype")||this.model.get("name")),this.switchRelatedView(t.$el)),this.model.attributes},afterRender:function(){var t=".enw__menu__link";this.$el.on("click",t,e.proxy(this.onMenuClick,this))},getRelatedView:function(){var e,t,a,i=this.mode;switch(!!i){case"avg"===i.subject&&"yearSlice"===i.year:t="avgChart",e=".avgChart",a=s;break;case"yearSlice"===i.year:t="subjectChart",e=".subjectChart",a=o;break;case"number"==typeof i.year&&"avg"!==i.subject:t="subjectYearChart",e=".subjectYearChart",a=l;break;default:t="avgYearTable",e=".avgYearTable",a=d}return this.initRelatedView(t,a,e)},onMenuClick:function(t){var a=e(t.target),i=a.data("href");return 2===this.status&&(a.parent().is(c)?this.switchMode(i):this.switchMode(void 0,i)),i},switchMode:function(e,t){var a=this.setMode(e,t),i=this.model,n=i.host+"/"+i.path;return a&&(this.selectMenuItem(a.subject,this.$el.find(c)),this.selectMenuItem(a.year,this.$el.find(h)),"avg"!==a.subject&&(n+="/"+a.subject),a.year&&"yearSlice"!==a.year&&(n+="/"+a.year),this.fetch(n)),a}})}),define("models/giaModel",["models/defaultModel"],function(e){return e.extend({path:"api/exams/gia"})}),define("views/exams/giaExamsView",["views/exams/examsView","models/giaModel"],function(e,t){return e.extend({title:"giaTitle",ModelConstructor:t})}),define("modules/examsModule",["views/exams/examsView","models/examsModel","views/exams/examsAvgChartView","views/exams/examsAvgYearView","views/exams/examsSubjectChartView","views/exams/examsSubjectYearChartView","models/giaModel","views/exams/giaExamsView"],function(){});