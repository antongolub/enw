define(["framework","underscore"],function(e,t){return{strictBool:function(e,t){return"boolean"==typeof e?e:!!t},isx64:function(){return"MacIntel"===window.navigator.platform||"Linux x86_64"===window.navigator.platform||navigator.userAgent.indexOf("WOW64")>-1||"Win64"===window.navigator.platform||!1},sortBy:function(e,c,n,a){if("object"==typeof e&&c){var r="string"==typeof c?function(e){return"function"==typeof e[c]?e[c]():e[c]||e}:"string"==typeof n?function(e){return e[n]}:function(e){return e},i=function(e){var c=r(e),n=["avg".toLocaleString(),"yearSlice".toLocaleString()];return t.contains(n,c)?"00"+c:c},o=a?i:r;return t.sortBy(e,o)}return e},getCacheSize:function(e){return this.getCacheScope(e).cacheSize},setCacheSize:function(e,t,c){var n=this.getCacheScope(t),a=1048576,r=isNaN(e)||"number"!=typeof e?a*(this.strictBool(c,this.isx64())?1:.25):e>20*a?20*a:0>e?0:e;return"number"==typeof n.cacheSize?this.freeCacheSpace(n,n.cacheSize-r):n.cacheRest=r,n.cacheSize=r,r},freeCacheSpace:function(e,t){var c,n=this.getCacheScope(e),a=this.getCache(n),r=n.cacheRest,i=n.cacheSize;if(i&&"number"==typeof t&&t>0){if(t>=i)this.flushCache(n);else for(;t>r;)c=n.cacheStack.shift(),r+=c.size,delete a[c.key];n.cacheRest=r}return r},getCacheScope:function(e){return"object"==typeof e?e:this.getDefaultCacheScope()},getDefaultCacheScope:function(){return"object"!=typeof window.Enw&&(window.Enw={}),window.Enw},getCache:function(e){var t=this.getCacheScope(e);return t.cache||(t.cache={},t.cacheStack=[],this.setCacheSize(this.getCacheSize(t),t)),t.cache},getCacheRest:function(e){var t=this.getCacheScope(e);return t.cacheRest},setToCache:function(e,t,c){var n=this.getCacheScope(c),a=this.getCache(c),r=n.cacheSize,i=this.sizeOf(t);return this.delFromCache(e,n),r>=i&&e&&(i>n.cacheRest&&this.freeCacheSpace(n,i),a[e]=t,n.cacheStack.push({key:e,size:i}),n.cacheRest-=i),t},getFromCache:function(e,t){return e?this.getCache(t)[e]:void 0},delFromCache:function(e,c){var n=this.getCacheScope(c),a=this.getCache(n),r=n.cacheStack;e&&a[e]&&(delete a[e],t.each(r,function(t,c){return t.key===e?(n.cacheRest+=t.size,void(r=r.splice(c,1))):void 0}))},flushCache:function(e){var t=this.getCacheScope(e);delete t.cache,delete t.cacheRest,delete t.cacheStack,delete t.cacheSize},replace:function(e,t,c){if(arguments.length>2)if(e instanceof Array){var n;for(n=e.length;n;n-=1)e[n-1]===t&&(e[n-1]=c)}else if("string"==typeof e)return e.replace(t,c);return e},sizeOf:function(e){var t,c,n,a,r=[e],i=0;for(t=0;t<r.length;t+=1)switch(typeof r[t]){case"boolean":i+=4;break;case"number":i+=8;break;case"string":i+=2*r[t].length;break;case"object":if("[object Array]"!==Object.prototype.toString.call(r[t]))for(a in r[t])r[t].hasOwnProperty(a)&&(i+=2*a.length);for(a in r[t])if(r[t].hasOwnProperty(a)){for(c=!1,n=0;n<r.length;n+=1)if(r[n]===r[t][a]){c=!0;break}c||r.push(r[t][a])}}return i}}});