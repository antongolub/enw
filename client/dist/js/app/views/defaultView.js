define(["backbone","handlebars","models/defaultModel","framework","utils","underscore","assets/titleHelper","assets/ifCondHelper","assets/localizationHelper","assets/menuHelper","css!styles/style.css"],function(t,e,s,n,i,r,o){return t.View.extend({initialize:function(){return this.self=this,this.modelInit({host:"http://"+this.host}),this.setStatus=r.wrap(this.setStatus,function(t,e){return this.setIndicator&&this.setIndicator(e),t(e)}),this},ModelConstructor:s,modelInit:function(t,e,s,n){var i;return e=e||this.ModelConstructor,e&&(s=s||"model",i=this[s],i&&(this.setStatus(1),i.off("change")),i=this[s]=new(e.extend(t))("object"==typeof n?n:{}),i.on("change",this.renderData,this)),i},renderData:function(){return!0},render:function(){return this.status<1&&(this.$el.append(e.compile(this.template||"")({id:this.id})),this.setElement(this.$el.find("#"+this.id)),this.setStatus(1),delete this.template,this.renderTitle(),this.afterRender(),this.afterRender=void 0,this.setMode()),this.update(),this},renderTitle:function(t){var e=".enw__title";return void 0!==t&&(this.title=t),n(e).html(o(this.title)),this.title},afterRender:function(){},setIndicator:function(t){var e="enw__widget--complete",s=2===(t||this.status);return this.$el.toggleClass(e,s),s},update:function(){this.fetch()},fetch:function(t){var e=i.getFromCache(t);this.model&&(this.model.clear({silent:!0}),t&&(this.model.instanceUrl=t),e?this.model.set(e):(this.setStatus(1),this.model.fetch({success:n.proxy(this.successCb,this),error:n.proxy(this.errorCb,this)})))},successCb:function(t,e){return this.setStatus(2),e.error||e.collection&&!e.collection.length?(console.warn("elasticnode.ru/widgets/#errorEmptyData"),this.showMsg("notFound"),!1):(i.setToCache(t.instanceUrl,e),this.switchModeDelayed(),!0)},errorCb:function(){return this.showMsg("connectionError"),console.warn("elasticnode.ru/widgets/#errorConnectionFailure"),this.setStatus(2),!0},renderMenu:function(t,s){var n=s||".enw__menu",r="menuTpl",o=this.$el.find(n),a=i.getFromCache(r)||i.setToCache(r,e.compile(e.partials.menu));return o.html(a(t)),this.selectMenuItem(o.children().eq(0)),o.size()>0},selectMenuItem:function(t,e){var s="enw__menu__link--active",i=n(t instanceof Object?t:'*[data-href="'+t+'"]');switch(!!s){case!!i.size():return i.addClass(s).siblings().removeClass(s),!0;case e instanceof n.fn.constructor:return e.children().removeClass(s),!0;default:return!1}},setMode:function(t){var e=this.mode||{},s=r.keys(e),n=function(){var t={},e=arguments;return r.each(s,function(s,n){t[s]=e[n]}),t},i=r.pick.apply(this,[r.defaults("object"==typeof t?t:n.apply(this,arguments),e)].concat(s));return r.isEqual(this.mode,i)?!1:(this.mode=i,i)},switchModeDelayed:function(){return this.delayedSetModeArgs&&this.delayedSetModeArgs.length&&this.switchMode?(this.switchMode.apply(this,this.delayedSetModeArgs),this.delayedSetModeArgs=void 0,!0):!1},showMsg:function(t){var e=".enw__msgbox",s=".enw__content",n="enw--hidden",i=this.$el.find(e),r=this.$el.find(s),o={notFound:"notFoundMsg".toLocaleString(),connectionError:"connectionErrorMsg".toLocaleString()};return t=o[t]||t,r.toggleClass(n,!!t),i.toggleClass(n,!t).html(t),t},showMessage:function(){return this.showMsg.apply(this,arguments)},initRelatedView:function(t,e,s){if(!this[t]&&e&&t&&s){var n=this.$el.find(s).get(0);n&&(this[t]=new(e.extend({widget:this}))({el:n}))}return this[t]},switchRelatedView:function(t,e){var s=e||"enw--displaynone";return t instanceof n.fn.constructor?t.removeClass(s).siblings().addClass(s):!1}})});