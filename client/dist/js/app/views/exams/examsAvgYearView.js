define(["views/tableView","underscore","text!templates/exams/examsTableTpl.hbs","text!templates/exams/examsRowTpl.hbs"],function(e,t,a,i){return e.extend({template:a,rowTemplate:i,renderRow:function(e,t){return this.rowTemplate({type:e.type,name:e.name,fullName:String(e.name).toLocaleString(),year:t,part:e.gtotal?(100*e.total/e.gtotal).toPrecision(3):"",threshold:e.threshold,minimum:e.minimum,maximum:e.maximum,limit:e.limit,belowThreshold:e.belowThreshold?(100*e.belowThreshold/e.total).toPrecision(3):"—",excellent:(100*e.excellent/e.total).toPrecision(3),average:e.average,averageCity:e.averageCity,averageRegion:e.averageRegion,averageCountry:e.averageCountry})},afterRender:function(){var e=".enw__link";this.$el.on("click",e,$.proxy(this.onSubjectLinkClick,this)),this.initSortable()},onSubjectLinkClick:function(e){var t,a,i;return e&&2===this.widget.status&&this.widget.switchMode&&(t=$(e.target),a=t.data("subject"),i=t.data("year"),this.widget.switchMode(a,i)),a},update:function(e,a){if(e&&a){var i="",n=0,o=0,r=0,l=0,s=this,m=".enw__table__tbody",h=".examAvg",c=".examAvgMathRus";t.each(t.sortBy(e,function(e){return String(e.name).toLocaleString()}),function(e){n+=e.total*e.average,r+=e.total,("math"===e.name||"russian"===e.name)&&(o+=e.total*e.average,l+=e.total),i+=s.renderRow(e,a)}),this.$el.find(m).html(i),this.$el.find(h).html(n?(n/r).toPrecision(3):"—"),this.$el.find(c).html(o?(o/l).toPrecision(3):"—")}return e}})});