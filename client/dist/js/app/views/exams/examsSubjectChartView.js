define(["views/chartView","underscore","utils"],function(t,e,o){var i="#777",r="#EEE";return t.extend({type:"spline",options:{yAxis:[{title:{text:"score".toLocaleString()+", %",style:{color:i,fontWeight:"normal"}},gridLineColor:r},{title:{text:"choice".toLocaleString()+", %",style:{color:i,fontWeight:"normal"}},gridLineColor:r,opposite:!0}],plotOptions:{series:{point:{events:{click:function(){return this.series.chart.options.getWidget().switchMode({year:this.category}),this.category}}}}},series:[{name:"school".toLocaleString()},{name:"district".toLocaleString()},{name:"region".toLocaleString()},{name:"country".toLocaleString()},{name:"whoChose".toLocaleString(),dashStyle:"shortdot",yAxis:1}]},update:function(t){if(this.chart&&t){var i,r,n=1/0,c=-1/0,a={school:[],city:[],region:[],country:[],choice:[]};return e.each(t,function(t){var e=new Date(t.date).getFullYear();e>c&&(c=e),n>e&&(n=e),t.y=e}),e.each(t,function(t){r=t.y-n,a.school[r]=t.average,a.city[r]=t.averageCity,a.region[r]=t.averageRegion,a.country[r]=t.averageCountry,a.choice[r]=100*t.total/(t.gtotal||t.total||1)}),i=e.range(n,c+1),e.each(a,function(t){t=o.replace(void 0,null)}),this.updateSpline(a.school,a.city,a.region,a.country,a.choice),this.chart.xAxis[0].setCategories(i,!1),this.redraw(),a}return void 0}})});