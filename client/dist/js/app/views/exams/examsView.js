define(["framework","views/defaultView","text!templates/exams/examsTpl.hbs","models/examsModel","underscore","utils","views/exams/examsAvgChartView","views/exams/examsSubjectChartView","views/exams/examsSubjectYearChartView","views/exams/examsAvgYearView"],function(e,t,a,r,s,i,n,u,c,h){var l=".enw__menu--primary",o=".enw__menu--secondary";return t.extend({template:a,name:"examsTpl",title:"egeTitle",ModelConstructor:r,mode:{subject:"avg",year:"yearSlice"},renderData:function(){var e=this.model.get("collection"),t=this.getRelatedView();return this.renderMenu&&(this.renderMenu(["avg"].concat(s.uniq(s.pluck(e,"name"))),l),this.renderMenu(["yearSlice"].concat(s.uniq(s.map(e,function(e){return new Date(e.date).getFullYear().toString()}))),o),this.renderMenu=void 0),this.showMsg(),t&&(t.render(e||this.model.attributes,this.model.get("subtype")||this.model.get("name")),this.switchRelatedView(t.$el)),this.model.attributes},afterRender:function(){var t=".enw__menu__link";this.$el.on("click",t,e.proxy(this.onMenuClick,this))},getRelatedView:function(){var e,t,a,r=this.mode;switch(!!r){case"avg"===r.subject&&"yearSlice"===r.year:t="avgChart",e=".avgChart",a=n;break;case"yearSlice"===r.year:t="subjectChart",e=".subjectChart",a=u;break;case"number"==typeof r.year&&"avg"!==r.subject:t="subjectYearChart",e=".subjectYearChart",a=c;break;default:t="avgYearTable",e=".avgYearTable",a=h}return this.initRelatedView(t,a,e)},onMenuClick:function(t){var a=e(t.target),r=a.data("href");return 2===this.status&&(a.parent().is(l)?this.switchMode(r):this.switchMode(void 0,r)),r},switchMode:function(e,t){var a=this.setMode(e,t),r=this.model,s=r.host+"/"+r.path;return a&&(this.selectMenuItem(a.subject,this.$el.find(l)),this.selectMenuItem(a.year,this.$el.find(o)),"avg"!==a.subject&&(s+="/"+a.subject),a.year&&"yearSlice"!==a.year&&(s+="/"+a.year),this.fetch(s)),a}})});