define(["views/chartView","underscore","utils"],function(t,e){return t.extend({examType:"ege",type:"spline",options:{yAxis:{title:{text:"score".toLocaleString()+", %"}},tooltip:{formatter:function(){return"<b>"+this.series.name+"</b><br/>"+this.x+": "+this.y.toPrecision(3)}},plotOptions:{series:{point:{events:{click:function(){return this.series.chart.options.getWidget().switchMode({year:this.category}),this.category}}}}},series:[{name:"weightedAvg".toLocaleString()},{name:"weightedAvgMathRus".toLocaleString()}]},dataproc:{respDivider:function(t,i,a,r){r=r||0;var s;return e.map(a,function(e){return s=t[e-r],"number"!=typeof s||isNaN(s)?null:s/(i[e-r]||1)})}},update:function(t){if(this.chart&&t&&!e.isEqual(this.data,t)){this.data=t;var i,a,r=1/0,s=-1/0,n={},o={},c=this.chart.series,h={},u={};return e.each(t,function(t){a=t.year||new Date(t.date).getFullYear(),t.year=a,a>s&&(s=a),r>a&&(r=a)}),e.each(t,function(t){a=t.year-r,n[a]=100*t.average/t.limit*t.total+(n[a]||0),o[a]=t.total+(o[a]||0),("math"===t.name||"russian"===t.name)&&(u[a]=100*t.average/t.limit*t.total+(u[a]||0),h[a]=t.total+(h[a]||0))}),i=e.range(r,s+1),c[0].update({data:this.dataproc.respDivider(n,o,i,r)},!1),c[1].update({data:this.dataproc.respDivider(u,h,i,r)},!1),this.chart.xAxis[0].setCategories(i,!1),this.redraw(),c}}})});